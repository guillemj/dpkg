# Copyright (C) 1994 Ian Murdock <imurdock@debian.org>
# Copyright (C) 1994,1995 Ian Jackson <ijackson@nyx.cs.du.edu>
#
#   This is free software; you can redistribute it and/or modify
#   it under the terms of the GNU General Public License as
#   published by the Free Software Foundation; either version 2,
#   or (at your option) any later version.
#
#   This is distributed in the hope that it will be useful, but
#   WITHOUT ANY WARRANTY; without even the implied warranty of
#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#   GNU General Public License for more details.
#
#   You should have received a copy of the GNU General Public
#   License along with dpkg; if not, write to the Free Software
#   Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.

srcdir = @srcdir@
VPATH = @srcdir@

prefix = @prefix@
copyingfile = $(prefix)/doc/copyright/dpkg

SRC =	ehandle.c mlib.c parse.c parsehelp.c fields.c dump.c nfmalloc.c \
	varbuf.c database.c myopt.c vercmp.c compat.c lock.c dbmodify.c \
	showcright.c tarfn.c star.c
OBJ =	ehandle.o mlib.o parse.o parsehelp.o fields.o dump.o nfmalloc.o \
	varbuf.o database.o myopt.o vercmp.o compat.o lock.o dbmodify.o \
	showcright.o tarfn.o star.o

INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA = @INSTALL_DATA@

CC = @CC@

CFLAGS = @CFLAGS@ @CWARNS@ $(XCFLAGS) -g # fixme: remove -g
OPTCFLAGS = @OPTCFLAGS@
LDFLAGS = -s $(XLDFLAGS)
ALL_CFLAGS = -I../include -I.. @DEFS@ $(CFLAGS)
ALL_CFLAGS_OPT = $(ALL_CFLAGS) $(OPTCFLAGS)

AR = ar crv
RANLIB = @RANLIB@

.SUFFIXES:	.c .o

all:		libdpkg.a

libdpkg.a:	$(OBJ)
		$(AR) libdpkg.a $(OBJ)
		$(RANLIB) libdpkg.a

showcright.o:	showcright.c
		$(CC) -DCOPYINGFILE=\"$(copyingfile)\" $(ALL_CFLAGS) -c $<

.c.o:
		$(CC) $(ALL_CFLAGS) -c $<

# These next few files are very heavily used, and should be optimised
# for speed rather than space.  (ALL_CFLAGS_OPT usually means -O3.)
database.o:	database.c
		$(CC) $(ALL_CFLAGS_OPT) -c $<

fields.o:	fields.c
		$(CC) $(ALL_CFLAGS_OPT) -c $<

nfmalloc.o:	nfmalloc.c
		$(CC) $(ALL_CFLAGS_OPT) -c $<

parse.o:	parse.c
		$(CC) $(ALL_CFLAGS_OPT) -c $<

parsehelp.o:	parsehelp.c
		$(CC) $(ALL_CFLAGS_OPT) -c $<

varbuf.o:	varbuf.c
		$(CC) $(ALL_CFLAGS_OPT) -c $<

clean:
		rm -f *.o core libdpkg.a

distclean:	clean
		rm -f Makefile *.orig *~ *.~* ./#*#

install:	all

dump.o fields.o parse.o parsehelp.o vercmp.o:	parsedump.h
$(OBJ):			../include/dpkg.h ../include/dpkg-db.h
myopt.o:		../include/myopt.h
tarfn.o star.o:		../include/tarfn.h
